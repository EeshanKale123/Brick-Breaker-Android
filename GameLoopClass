package com.example.eeshan.brickbreaker;

import android.graphics.Canvas;

/**
 * Created by Eeshan on 2/26/2016.
 */
public class GameLoopClass extends Thread {
    private GameViewClass _gameView;
    private Boolean _running = false;
    private static final long FPS = 10;

    public GameLoopClass(GameViewClass $view){
        this._gameView = $view;
    }

    public void setRunning(Boolean $flag){
        this._running = $flag;
    }

    public void run(){
        long tick = 1000/FPS;
        long startTime;
        long sleepTime;
        while(_running){
            Canvas canvas = null;
                startTime = System.currentTimeMillis();
            try{
                canvas = _gameView.getHolder().lockCanvas();
                synchronized (_gameView.getHolder()){
                    _gameView.onDraw(canvas);
                    _gameView.checkCollision();
                }
            }
            finally {
                if(canvas!=null){
                    _gameView.getHolder().unlockCanvasAndPost(canvas);
                }
            }
            sleepTime = tick - (System.currentTimeMillis()-startTime);
            try{
                if(sleepTime>0)
                    sleep(sleepTime);
                else
                    sleep(10);              //Change this value based on how much the CPU is affected performance-wise
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
